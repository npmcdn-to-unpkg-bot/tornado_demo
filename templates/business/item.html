{% extends "../base.html" %}
{% block content %}
<div id="content">
    <div id="content-header">
        <div id="breadcrumb"> 
            <a href="/" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a>
            <a href="" class="current">business</a>
        </div>
        <h1>优购物业务-频道页</h1>
    </div>
    <div class="container-fluid">
        <hr>
        <div class="row-fluid">
            <div class="span3" style="width:17.9%">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-signal"></i> </span>
                    <h5><a href="" id="title0"></a></h5>
                    </div>
                    <div class="widget-content">
                        <div id="gauge0" class="bars" style="height:300px;"></div>
                        <div id="bars0" class="bars" style="height: 120px;"></div>
                    </div>
                </div>
            </div>
            <div class="span3" style="width:17.9%">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-signal"></i> </span>
                    <h5><a href="" id="title1"></a></h5>
                    </div>
                    <div class="widget-content">
                        <div id="gauge1" class="bars" style="height:300px;"></div>
                        <div id="bars1" class="bars" style="height: 120px;"></div>
                    </div>
                </div>
            </div>
            <div class="span3" style="width:17.9%">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-signal"></i> </span>
                    <h5><a href="" id="title2"></a></h5>
                    </div>
                    <div class="widget-content">
                        <div id="gauge2" class="bars" style="height:300px;"></div>
                        <div id="bars2" class="bars" style="height: 120px;"></div>
                    </div>
                </div>
            </div>
            <div class="span3" style="width:17.9%">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-signal"></i> </span>
                    <h5><a href="" id="title3"></a></h5>
                    </div>
                    <div class="widget-content">
                        <div id="gauge3" class="bars" style="height:300px;"></div>
                        <div id="bars3" class="bars" style="height: 120px;"></div>
                    </div>
                </div>
            </div>
            <div class="span3" style="width:17.9%">
                <div class="widget-box">
                    <div class="widget-title"> <span class="icon"> <i class="icon-signal"></i> </span>
                    <h5><a href="" id="title4"></a></h5>
                    </div>
                    <div class="widget-content">
                        <div id="gauge4" class="bars" style="height:300px;"></div>
                        <div id="bars4" class="bars" style="height: 120px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="widget-box">
                    <div class="widget-title"><span class="icon"> <i class="icon-hand-right"></i> </span>
                        <h5>用户模块</h5>
                    </div>
                    <div class="widget-content nopadding">
                        <table class="table table-bordered data-table" id="js_data_detail">
                            <thead>
                                <tr>
                                    <th>登录</th>
                                    <th>查询用户基本信息</th>
                                    <th>进入用户中心</th>
                                    <th>查询用户</th>
                                    <th>查询用户积分</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="gradeX">
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                </tr>
                                <tr class="gradeX">
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                </tr>
                                <tr class="gradeC">
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                </tr>
                                <tr class="gradeX">
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                </tr>

                                <tr class="gradeX">
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                    <td><span class="date badge badge-important">错误</span></td>
                                    <td><span class="date badge badge-success">正常</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% end %}
{% block footer %}
<script src="/js/echarts.min.js"></script>
<script>
    //var myChart = echarts.init(document.getElementById('bars'));
    //var myChart11 = echarts.init(document.getElementById('bars11'));
    function get_data_gauge(data) {
        options = {
            tooltip: {
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                show: true,
                feature: {
                    mark: {show: true},
                    restore: {show: true},
                    saveAsImage: {show: true}
                }
            },
            series: [
                {
                    name: '业务指标',
                    type: 'gauge',
                    splitNumber: 10,       // 分割段数，默认为5
                    axisLine: {            // 坐标轴线
                        lineStyle: {       // 属性lineStyle控制线条样式
                            //color: [[0.2, '#C23531'], [0.8, '#63869E'], [1, '#91C7AE']],
                            color: [[0.95, '#C23531'], [1, '#91C7AE']],
                        }
                    },
                    min:0,
                    max:100,
                    //center : ['50%', '50%'],    // 默认全局居中
                    radius : '85%',
                    detail: {formatter: '{value}%'},
                    data: data
                }
            ]


        };

        return options;
    }


    function get_data_bar(data) {
        options = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: ['时', '日']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'value',
                    splitLine: {
                        show: false             //背景格线不显示
                    }
                }
            ],
            yAxis: [
                {
                    type: 'category',
                    data: ['时', '日'],
                    splitLine: {
                        show: false             //背景格线不显示
                    }
                }
            ],
            series: [

               {
                    //name: '60分钟',
                    type: 'bar',
                    stack: '可用率',
                    barWidth:15,
                    itemStyle: {
                        normal: {
                            color: function (params) {
                                var colorList = [];
                                if(data[0]<=95)
                                {
                                    colorList[0] = '#C23531';
                                }
                                else
                                {
                                    colorList[0] = '#91C7AE';
                                };
                                if(data[1]<=95)
                                {
                                    colorList[1] = '#C23531';
                                }
                                else
                                {
                                    colorList[1] = '#91C7AE';
                                };


                                //var colorList = ['#C23531', '#91C7AE']
                                return colorList[params.dataIndex]

                            },
                            label: {show: true, position: 'insideRight'}
                        }
                    },
                    //itemStyle: {normal: {label: {show: true, position: 'insideRight'}}},
                    data: data
                }
            ]


        };

        return options;
    }


    //myChart.setOption(get_data());

    var item = "{{item}}";

    // echarts.init(document.getElementById('gauge0')).setOption(get_data_gauge([{value: 100, name: '30分钟'}]));
    // echarts.init(document.getElementById('gauge1')).setOption(get_data_gauge([{value: 80, name: '30分钟'}]));
    // echarts.init(document.getElementById('gauge2')).setOption(get_data_gauge([{value: 80, name: '30分钟'}]));
    // echarts.init(document.getElementById('gauge3')).setOption(get_data_gauge([{value: 0, name: '30分钟'}]));
    // echarts.init(document.getElementById('gauge4')).setOption(get_data_gauge([{value: 100, name: '30分钟'}]));

    // echarts.init(document.getElementById('bars0')).setOption(get_data_bar([100, 100]));
    // echarts.init(document.getElementById('bars1')).setOption(get_data_bar([100, 80]));
    // echarts.init(document.getElementById('bars2')).setOption(get_data_bar([80, 100]));
    // echarts.init(document.getElementById('bars3')).setOption(get_data_bar([0, 0]));
    // echarts.init(document.getElementById('bars4')).setOption(get_data_bar([100, 100]));

    function getData(item) {
        $.ajax({
            url: '/api/business_data/' + item,
            dataType: 'json',
            beforeSend: function () {

            },
            success: function (res) {
                var len_arr = res['gauge'].length;
                for (var i = 0; i < 6; i++) {
                    if (i < len_arr) {
                        $("#title" + i).empty();
                        $("#title" + i).append(res['title'][i]);
                        $("#title" + i).attr("href", res['title_link'][i]);
                        echarts.init(document.getElementById('gauge' + i)).setOption(get_data_gauge([{value: res['gauge'][i], name: '30分钟'}]));
                        echarts.init(document.getElementById('bars' + i)).setOption(get_data_bar(res['bar'][i]));
                    }
                    else {

                    }

                }
                var li = ''
                li += '<thead><tr>'
                $.each(res['detail_column'], function (index, array) {
                    li += "<th>" + array + "</th>";
                });
                li += '</br></thead><tbody>'


                $.each(res['detail_data'], function (index, array) {
                    li += "<tr>";
                    $.each(array, function (index0, array0)
                    {
                        li += "<td>" + array0 + "%</td>";
                    })
                    li += "</tr>";
                });
                li += '</tbody>';
                $("#js_data_detail").empty();
                $("#js_data_detail").append(li);


            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
    getData(item);
</script>
{% end %}
